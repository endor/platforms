/*
 * Copyright (c) 2010 Chris O'Hara <cohara87@gmail.com>
 * 
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 * 
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
(function(h){var k={"&nbsp;":" ","&iexcl;":"¡","&cent;":"¢","&pound;":"£","&curren;":"€","&yen;":"¥","&brvbar;":"Š","&sect;":"§","&uml;":"š","&copy;":"©","&ordf;":"ª","&laquo;":"«","&not;":"¬","&shy;":"­","&reg;":"®","&macr;":"¯","&deg;":"°","&plusmn;":"±","&sup2;":"²","&sup3;":"³","&acute;":"Ž","&micro;":"µ","&para;":"¶","&middot;":"·","&cedil;":"ž","&sup1;":"¹","&ordm;":"º","&raquo;":"»","&frac14;":"Œ","&frac12;":"œ","&frac34;":"Ÿ","&iquest;":"¿","&Agrave;":"À","&Aacute;":"Á","&Acirc;":"Â","&Atilde;":"Ã","&Auml;":"Ä","&Aring;":"Å","&AElig;":"Æ","&Ccedil;":"Ç","&Egrave;":"È","&Eacute;":"É","&Ecirc;":"Ê","&Euml;":"Ë","&Igrave;":"Ì","&Iacute;":"Í","&Icirc;":"Î","&Iuml;":"Ï","&ETH;":"Ð","&Ntilde;":"Ñ","&Ograve;":"Ò","&Oacute;":"Ó","&Ocirc;":"Ô","&Otilde;":"Õ","&Ouml;":"Ö","&times;":"×","&Oslash;":"Ø","&Ugrave;":"Ù","&Uacute;":"Ú","&Ucirc;":"Û","&Uuml;":"Ü","&Yacute;":"Ý","&THORN;":"Þ","&szlig;":"ß","&agrave;":"à","&aacute;":"á","&acirc;":"â","&atilde;":"ã","&auml;":"ä","&aring;":"å","&aelig;":"æ","&ccedil;":"ç","&egrave;":"è","&eacute;":"é","&ecirc;":"ê","&euml;":"ë","&igrave;":"ì","&iacute;":"í","&icirc;":"î","&iuml;":"ï","&eth;":"ð","&ntilde;":"ñ","&ograve;":"ò","&oacute;":"ó","&ocirc;":"ô","&otilde;":"õ","&ouml;":"ö","&divide;":"÷","&oslash;":"ø","&ugrave;":"ù","&uacute;":"ú","&ucirc;":"û","&uuml;":"ü","&yacute;":"ý","&thorn;":"þ","&yuml;":"&#255;","&quot;":'"',"&lt;":"<","&gt;":">","&apos;":"&#39;","&minus;":"&#8722;","&circ;":"&#710;","&tilde;":"&#732;","&Scaron;":"&#352;","&lsaquo;":"&#8249;","&OElig;":"&#338;","&lsquo;":"&#8216;","&rsquo;":"&#8217;","&ldquo;":"&#8220;","&rdquo;":"&#8221;","&bull;":"&#8226;","&ndash;":"&#8211;","&mdash;":"&#8212;","&trade;":"&#8482;","&scaron;":"&#353;","&rsaquo;":"&#8250;","&oelig;":"&#339;","&Yuml;":"&#376;","&fnof;":"&#402;","&Alpha;":"&#913;","&Beta;":"&#914;","&Gamma;":"&#915;","&Delta;":"&#916;","&Epsilon;":"&#917;","&Zeta;":"&#918;","&Eta;":"&#919;","&Theta;":"&#920;","&Iota;":"&#921;","&Kappa;":"&#922;","&Lambda;":"&#923;","&Mu;":"&#924;","&Nu;":"&#925;","&Xi;":"&#926;","&Omicron;":"&#927;","&Pi;":"&#928;","&Rho;":"&#929;","&Sigma;":"&#931;","&Tau;":"&#932;","&Upsilon;":"&#933;","&Phi;":"&#934;","&Chi;":"&#935;","&Psi;":"&#936;","&Omega;":"&#937;","&alpha;":"&#945;","&beta;":"&#946;","&gamma;":"&#947;","&delta;":"&#948;","&epsilon;":"&#949;","&zeta;":"&#950;","&eta;":"&#951;","&theta;":"&#952;","&iota;":"&#953;","&kappa;":"&#954;","&lambda;":"&#955;","&mu;":"&#956;","&nu;":"&#957;","&xi;":"&#958;","&omicron;":"&#959;","&pi;":"&#960;","&rho;":"&#961;","&sigmaf;":"&#962;","&sigma;":"&#963;","&tau;":"&#964;","&upsilon;":"&#965;","&phi;":"&#966;","&chi;":"&#967;","&psi;":"&#968;","&omega;":"&#969;","&thetasym;":"&#977;","&upsih;":"&#978;","&piv;":"&#982;","&ensp;":"&#8194;","&emsp;":"&#8195;","&thinsp;":"&#8201;","&zwnj;":"&#8204;","&zwj;":"&#8205;","&lrm;":"&#8206;","&rlm;":"&#8207;","&sbquo;":"&#8218;","&bdquo;":"&#8222;","&dagger;":"&#8224;","&Dagger;":"&#8225;","&hellip;":"&#8230;","&permil;":"&#8240;","&prime;":"&#8242;","&Prime;":"&#8243;","&oline;":"&#8254;","&frasl;":"&#8260;","&euro;":"&#8364;","&image;":"&#8465;","&weierp;":"&#8472;","&real;":"&#8476;","&alefsym;":"&#8501;","&larr;":"&#8592;","&uarr;":"&#8593;","&rarr;":"&#8594;","&darr;":"&#8595;","&harr;":"&#8596;","&crarr;":"&#8629;","&lArr;":"&#8656;","&uArr;":"&#8657;","&rArr;":"&#8658;","&dArr;":"&#8659;","&hArr;":"&#8660;","&forall;":"&#8704;","&part;":"&#8706;","&exist;":"&#8707;","&empty;":"&#8709;","&nabla;":"&#8711;","&isin;":"&#8712;","&notin;":"&#8713;","&ni;":"&#8715;","&prod;":"&#8719;","&sum;":"&#8721;","&lowast;":"&#8727;","&radic;":"&#8730;","&prop;":"&#8733;","&infin;":"&#8734;","&ang;":"&#8736;","&and;":"&#8743;","&or;":"&#8744;","&cap;":"&#8745;","&cup;":"&#8746;","&int;":"&#8747;","&there4;":"&#8756;","&sim;":"&#8764;","&cong;":"&#8773;","&asymp;":"&#8776;","&ne;":"&#8800;","&equiv;":"&#8801;","&le;":"&#8804;","&ge;":"&#8805;","&sub;":"&#8834;","&sup;":"&#8835;","&nsub;":"&#8836;","&sube;":"&#8838;","&supe;":"&#8839;","&oplus;":"&#8853;","&otimes;":"&#8855;","&perp;":"&#8869;","&sdot;":"&#8901;","&lceil;":"&#8968;","&rceil;":"&#8969;","&lfloor;":"&#8970;","&rfloor;":"&#8971;","&lang;":"&#9001;","&rang;":"&#9002;","&loz;":"&#9674;","&spades;":"&#9824;","&clubs;":"&#9827;","&hearts;":"&#9829;","&diams;":"&#9830;"};var a=function(q){if(!~q.indexOf("&")){return q}for(var p in k){q=q.replace(new RegExp(p,"g"),k[p])}q=q.replace("&nbsp;"," ");q=q.replace(/&#x(0*[0-9a-f]{2,5});?/gi,function(r,s){return String.fromCharCode(parseInt(+s,16))});q=q.replace(/&#([0-9]{2,4});?/gi,function(r,s){return String.fromCharCode(+s)});q=q.replace(/&amp;/g,"&");return q};var l=function(q){q=q.replace(/&/g,"&amp;");for(var p in k){q=q.replace(new RegExp(k[p],"g"),p)}return q};h.entities={encode:l,decode:a};var g={"document.cookie":"[removed]","document.write":"[removed]",".parentNode":"[removed]",".innerHTML":"[removed]","window.location":"[removed]","-moz-binding":"[removed]","<!--":"&lt;!--","-->":"--&gt;","<![CDATA[":"&lt;![CDATA["};var m={"javascript\\s*:":"[removed]","expression\\s*(\\(|&\\#40;)":"[removed]","vbscript\\s*:":"[removed]","Redirect\\s+302":"[removed]"};var o=[/%0[0-8bcef]/g,/%1[0-9a-f]/g,/[\x00-\x08]/g,/\x0b/g,/\x0c/g,/[\x0e-\x1f]/g];var i=["javascript","expression","vbscript","script","applet","alert","document","write","cookie","window"];h.xssClean=function(u,p){if(typeof u==="array"||typeof u==="object"){for(var r in u){u[r]=xssClean(u[r])}return u}u=j(u);u=u.replace(/\&([a-z\_0-9]+)\=([a-z\_0-9]+)/i,f()+"$1=$2");u=u.replace(/(&\#?[0-9a-z]{2,})([\x00-\x20])*;?/i,"$1;$2");u=u.replace(/(&\#x?)([0-9A-F]+);?/i,"$1;$2");u=u.replace(f(),"&");u=decodeURIComponent(u);u=u.replace(/[a-z]+=([\'\"]).*?\\1/gi,function(v,w){return v.replace(w,d(w))});u=u.replace(/<\w+.*?(?=>|<|$)/gi,function(v,w){});u=j(u);u=u.replace("\t"," ");var t=u;for(var r in g){u=u.replace(r,g[r])}for(var r in m){u=u.replace(new RegExp(r,"i"),m[r])}for(var r in i){var s=i[r].split("").join("\\s*")+"\\s*";u=u.replace(new RegExp("("+s+")(\\W)","ig"),function(v,w,x){return w.replace(/\s+/g,"")+x})}do{var q=u;if(u.match(/<a/i)){u=u.replace(/<a\\s+([^>]*?)(>|$)/gi,function(v,w,x){w=n(w.replace("<","").replace(">",""));return v.replace(w,w.replace(/href=.*?(alert\(|alert&\#40;|javascript\:|charset\=|window\.|document\.|\.cookie|<script|<xss|base64\\s*,)/gi,""))})}if(u.match(/<img/i)){u=u.replace(/<img\\s+([^>]*?)(\\s?\/?>|$)/gi,function(v,w,x){w=n(w.replace("<","").replace(">",""));return v.replace(w,w.replace(/src=.*?(alert\(|alert&\#40;|javascript\:|charset\=|window\.|document\.|\.cookie|<script|<xss|base64\\s*,)/gi,""))})}if(u.match(/script/i)||u.match(/xss/i)){u=u.replace(/<(\/*)(script|xss)(.*?)\>/gi,"[removed]")}}while(q!=u);event_handlers=["[^a-z_-]onw*"];if(!p){event_handlers.push("xmlns")}u=u.replace(new RegExp("<([^><]+?)("+event_handlers.join("|")+")(\\s*=\\s*[^><]*)([><]*)","i"),"<$1$4");naughty="alert|applet|audio|basefont|base|behavior|bgsound|blink|body|embed|expression|form|frameset|frame|head|html|ilayer|iframe|input|isindex|layer|link|meta|object|plaintext|style|script|textarea|title|video|xml|xss";u=u.replace(new RegExp("<(/*\\s*)("+naughty+")([^><]*)([><]*)","gi"),function(w,x,v,z,y){return"&lt;"+x+v+z+y.replace(">","&gt;").replace("<","&lt;")});u=u.replace(/(alert|cmd|passthru|eval|exec|expression|system|fopen|fsockopen|file|file_get_contents|readfile|unlink)(\\s*)\((.*?)\)/gi,"$1$2&#40;$3&#41;");for(var r in g){u=u.replace(r,g[r])}for(var r in m){u=u.replace(new RegExp(r,"i"),m[r])}if(p&&u!==t){throw"Image may contain XSS"}return u};function j(q){for(var p in o){q=q.replace(o[p],"")}return q}function f(){return"!*$^#(@*#&"}function d(p){return p.replace(">","&gt;").replace("<","&lt;").replace("\\","\\\\")}function n(p){out="";p.replace(/\\s*[a-z\-]+\\s*=\\s*(?:\042|\047)(?:[^\\1]*?)\\1/gi,function(q){$out+=q.replace(/\/\*.*?\*\//g,"")});return out}var e=h.Validator=function(){};e.prototype.check=function(p,q){this.str=String(p||"");this.msg=q;return this};e.prototype.validate=e.prototype.check;e.prototype.assert=e.prototype.check;e.prototype.error=function(p){throw p};e.prototype.isEmail=function(){if(!this.str.match(/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/)){this.error(this.msg||"Invalid email")}return this};e.prototype.isUrl=function(){if(!this.str.match(/^(?:(?:ht|f)tp(?:s?)\:\/\/|~\/|\/)?(?:\w+:\w+@)?((?:(?:[-\w\d{1-3}]+\.)+(?:com|org|net|gov|mil|biz|info|mobi|name|aero|jobs|edu|co\.uk|ac\.uk|it|fr|tv|museum|asia|local|travel|[a-z]{2})?)|((\b25[0-5]\b|\b[2][0-4][0-9]\b|\b[0-1]?[0-9]?[0-9]\b)(\.(\b25[0-5]\b|\b[2][0-4][0-9]\b|\b[0-1]?[0-9]?[0-9]\b)){3}))(?::[\d]{1,5})?(?:(?:(?:\/(?:[-\w~!$+|.,=]|%[a-f\d]{2})+)+|\/)+|\?|#)?(?:(?:\?(?:[-\w~!$+|.,*:]|%[a-f\d{2}])+=?(?:[-\w~!$+|.,*:=]|%[a-f\d]{2})*)(?:&(?:[-\w~!$+|.,*:]|%[a-f\d{2}])+=?(?:[-\w~!$+|.,*:=]|%[a-f\d]{2})*)*)*(?:#(?:[-\w~!$ |\/.,*:;=]|%[a-f\d]{2})*)?$/)){this.error(this.msg||"Invalid URL")}return this};e.prototype.isIP=function(){if(!this.str.match(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/)){this.error(this.msg||"Invalid IP")}return this};e.prototype.isAlpha=function(){if(!this.str.match(/^[a-zA-Z]+$/)){this.error(this.msg||"Invalid characters")}return this};e.prototype.isAlphanumeric=function(){if(!this.str.match(/^[a-zA-Z0-9]+$/)){this.error(this.msg||"Invalid characters")}return this};e.prototype.isNumeric=function(){if(!this.str.match(/^-?[0-9]+$/)){this.error(this.msg||"Invalid number")}return this};e.prototype.isLowercase=function(){if(!this.str.match(/^[a-z0-9]+$/)){this.error(this.msg||"Invalid characters")}return this};e.prototype.isUppercase=function(){if(!this.str.match(/^[A-Z0-9]+$/)){this.error(this.msg||"Invalid characters")}return this};e.prototype.isInt=function(){if(!this.str.match(/^(?:-?(?:0|[1-9][0-9]*))$/)){this.error(this.msg||"Invalid integer")}return this};e.prototype.isDecimal=function(){if(!this.str.match(/^(?:-?(?:0|[1-9][0-9]*))?(?:\.[0-9]*)?$/)){this.error(this.msg||"Invalid decimal")}return this};e.prototype.isFloat=function(){return this.isDecimal()};e.prototype.notNull=function(){if(this.str===""){this.error(this.msg||"Invalid characters")}return this};e.prototype.isNull=function(){if(this.str!==""){this.error(this.msg||"Invalid characters")}return this};e.prototype.notEmpty=function(){if(this.str.match(/^[\s\t\r\n]*$/)){this.error(this.msg||"String is whitespace")}return this};e.prototype.equals=function(p){if(this.str!=p){this.error(this.msg||"Not equal")}return this};e.prototype.contains=function(p){if(this.str.indexOf(p)===-1){this.error(this.msg||"Invalid characters")}return this};e.prototype.notContains=function(p){if(this.str.indexOf(p)>=0){this.error(this.msg||"Invalid characters")}return this};e.prototype.regex=e.prototype.is=function(q,p){if(typeof q!=="function"){q=new RegExp(q,p)}if(!this.str.match(q)){this.error(this.msg||"Invalid characters")}return this};e.prototype.notRegex=e.prototype.not=function(q,p){if(typeof q!=="function"){q=new RegExp(q,p)}if(this.str.match(q)){this.error(this.msg||"Invalid characters")}return this};e.prototype.len=function(q,p){if(this.str.length<q){this.error(this.msg||"String is too small")}if(typeof p!==undefined&&this.str.length>p){this.error(this.msg||"String is too large")}return this};var c=h.Filter=function(){};var b="\\r\\n\\t\\s";c.prototype.modify=function(p){this.str=p};c.prototype.convert=c.prototype.sanitize=function(p){this.str=p;return this};c.prototype.xss=function(p){this.modify(xssClean(this.str,p));return this.str};c.prototype.entityDecode=function(){this.modify(a(this.str));return this.str};c.prototype.entityEncode=function(){this.modify(l(this.str));return this.str};c.prototype.ltrim=function(p){p=p||b;this.modify(this.str.replace(new RegExp("^["+p+"]+","g"),""));return this.str};c.prototype.rtrim=function(p){p=p||b;this.modify(this.str.replace(new RegExp("["+p+"]+$","g"),""));return this.str};c.prototype.trim=function(p){p=p||b;this.modify(this.str.replace(new RegExp("^["+p+"]+|["+p+"]+$","g"),""));return this.str};c.prototype.ifNull=function(p){if(!this.str||this.str===""){this.modify(p)}return this.str};c.prototype.toFloat=function(){this.modify(parseFloat(this.str));return this.str};c.prototype.toInt=function(){this.modify(parseInt(this.str));return this.str};c.prototype.toBoolean=function(){if(!this.str||this.str=="0"||this.str=="false"||this.str==""){this.modify(false)}else{this.modify(true)}return this.str};c.prototype.toBooleanStrict=function(){if(this.str=="1"||this.str=="true"){this.modify(true)}else{this.modify(false)}return this.str};h.sanitize=h.convert=function(q){var p=new h.Filter();return p.sanitize(q)};h.check=h.validate=h.assert=function(q,r){var p=new h.Validator();return p.check(q,r)}})(this);